{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFunction (val) {\r\n    return typeof val === 'function'\r\n}\r\n\r\nexport function isObject (val) {\r\n    return typeof val === 'object' && val !== null\r\n}","// arrayMethods.__proto__ = Array.prototype\r\nlet oldArrayProrotype = Array.prototype\r\nexport let arrayMethods = Object.create(oldArrayProrotype)\r\n\r\nlet methods = [\r\n    'push',\r\n    'shift',\r\n    'unshift',\r\n    'pop',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    // 用户调用的，如果是以上七个方法，则使用自己重写的，否则用原来的数组方法\r\n    arrayMethods[method] = function (...args) {\r\n        // vm.name.push(×××), 则this表示vm\r\n        oldArrayProrotype[method].call(this, ...args)\r\n        // 新增的内容\r\n        let inserted\r\n        // 根据当前数组获取到observe实例\r\n        let ob = this.__ob__\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args\r\n                break\r\n            case 'splice':\r\n                inserted = args.splice(2)\r\n                break\r\n            default:\r\n                break\r\n        }\r\n        // 如果有新增的内容要进行继续劫持\r\n        if (inserted) {\r\n            ob.observeArray(inserted)\r\n        }\r\n    }\r\n})","import { isObject } from \"../utils\";\r\nimport { arrayMethods } from './array'\r\n\r\nclass Observer {\r\n    // 对对象中的所有属性进行劫持\r\n    constructor (data) {\r\n        // 使__ob__属性不可枚举，如果不这么做，data会一直是一个对象，则溢栈\r\n        // 这里把__ob__挂载在实例上，同时此属性不可枚举\r\n        Object.defineProperty(data, '__ob__', {\r\n            value: this,\r\n            enumerable: false\r\n        })\r\n        // 如果是数组，则进行数组劫持的逻辑\r\n        // 对数组原来的方法进行改写\r\n        if (Array.isArray(data)) {\r\n            data.__proto__ = arrayMethods\r\n            // 如果数组中的数据是对象类型，需要监控对象的变化\r\n            this.observeArray(data)\r\n        } else {\r\n            this.walk(data)\r\n        }\r\n    }\r\n    observeArray(data) {\r\n        // 对数组中的数组 数组中的对象再次劫持\r\n        data.forEach(item => {\r\n            observe(item)\r\n        })\r\n    }\r\n    walk(data) {\r\n        Object.keys(data).forEach(key => {\r\n            defineReactive(data, key, data[key])\r\n        })\r\n    }\r\n}\r\n\r\n// vue2 会对对象进行遍历，将每个属性使用defineProperty 重新定义，导致性能差\r\nfunction defineReactive(data, key, value) {\r\n    // 如果value是一个对象，则继续递归进行劫持\r\n    observe(value) \r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newV) {\r\n            // 如果用户赋值一个新对象，需要将这个对象进行劫持\r\n            observe(newV)\r\n            value = newV\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n    // 如果是对象才观察（省略对数组进行处理）\r\n    if (!isObject(data)) {\r\n        return\r\n    }\r\n    // 如果已经被观察过了则不需再观察\r\n    if (data.__ob__) {\r\n        return\r\n    }\r\n    // 默认最外层 data 必须是一个对象\r\n    return new Observer(data)\r\n}","import { isFunction } from \"./utils\"\r\nimport { observe } from \"./observer/index\"\r\n\r\nexport function initState (vm) {\r\n    const opts = vm.$options\r\n    // 初始化data\r\n    if (opts.data) {\r\n        initData(vm)\r\n    }\r\n    // 初始化方法\r\n    if (opts.methods) {\r\n        initMethod(vm)\r\n    }\r\n    // 初始化 props\r\n    if (opts.props) {\r\n        initProps(vm)\r\n    }\r\n    // 初始化 computed\r\n    if (opts.computed) {\r\n        initComputed(vm)\r\n    }\r\n    // 初始化 watch\r\n    if (opts.watch) {\r\n        initWatch(vm)\r\n    }\r\n\r\n    function proxy (vm, source, key) {\r\n        Object.defineProperty(vm, key, {\r\n            get() {\r\n                return vm[source][key]\r\n            },\r\n            set(newValue) {\r\n                vm[source][key] = newValue\r\n            }\r\n        })\r\n    }\r\n    \r\n    function initData(vm) {\r\n        let data = vm.$options.data\r\n        // vue2 中会将data 中的所有数值进行数据劫持(Object.defineProperty)\r\n        // 如果传入的data 是一个方法，则取其返回值，否则取其值\r\n        data = vm._data = isFunction(data) ? data.call(vm) : data\r\n\r\n        // 数据响应式\r\n        observe(data)\r\n\r\n        // 数据代理\r\n        for (let key in data) {\r\n            proxy(vm, '_data', key)\r\n        }\r\n    }\r\n\r\n    // 未实现的方法\r\n    function initProps() {}\r\n    function initMethod() {}\r\n    function initComputed() {}\r\n    function initWatch() {}\r\n}","import { initState } from \"./state\"\r\n\r\nexport function initMixin (Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        // el, data\r\n        const vm = this\r\n        vm.$options = options\r\n\r\n        // 对数据进行初始化（watch、computed、props、data...）\r\n        // 这些数据都存在于vm.options\r\n        initState(vm)\r\n    }\r\n}","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) {\r\n    // options 为用户传入的选项\r\n    this._init(options) // 初始化操作、组件\r\n}\r\n\r\n// 给原型上新增_init 方法\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":[],"mappings":"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"}
# 一、DNS

## 1.DNS 协议的概念

**概念**:DNS是域名系统(Domain Name System)的缩写，提供的是一种主机名到IP地址的转换服务，就是我们常说的域名系统。它是一个由分层的DNS服务器组成的分布式数据库，是定义了主机如何查询这个分布式数据库的方式的应用层协议。能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。

**作用**:将域名解析为IP地址，客户端向DNS服务器(DNS服务器有自己的IP地址)发送域名查询请求，DNS服务器告知客户机Web服务器的IP地址。

## 2.DNS同时使用TCP和UDP协议

 **DNS占用53号端口，同时使用TCP和UDP协议。**

1. 在区域传输的时候使用TCP协议
   - 辅域名服务器会定时(一般3小时)向主域名服务器进行查询以便了解数据是否有变动。如有变动，会执行一次区域传送，进行数据同步。
   - 区域传送使用TCP而不是UDP，因为数据同步传送的数据量比一个请求应答的数据量要多得多。
2. 在域名解析的时候使用UDP协议
   - 客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可。不用经过三次握手，这样DNS服务器负载更低，响应更快。理论上说，客户端也可以指定向DNS服务器查询时用TCP，但事实上，很多DNS服务器进行配置的时候，仅支持UDP查询包。

## 3.DNS完整的查询过程

**DNS服务器解析域名的过程：**

1. 首先在**浏览器缓存**中查找对应的**IP地址**，如果查找到直接返回，若找不到继续下一步
2. 将请求发送给**本地DNS服务器**，在本地域名服务器缓存中查询，如果查找到，就直接将查找结果返回，若找不到继续下一步
3. 本地DNS服务器向**根域名服务器**发送请求，根域名服务器会返回一个所查询域的顶级域名服务器地址
4. 本地DNS服务器向**顶级域名服务器**发送请求，接受请求的服务器查询自己的缓存，如果有记录，就返回查询结果，如果没有就返回相关的下一级的权威域名服务器的地址
5. 本地DNS服务器向**权威域名服务器**发送请求，域名服务器返回对应的结果
6. 本地DNS服务器将返回结果保存在缓存中，便于下次使用
7. 本地DNS服务器将返回结果返回给浏览器

## 4.迭代查询与递归查询

- 递归查询指的是查询请求发出后，域名服务器代为向下一级域名服务器发出请求,最后向用户返回查询的最终结果。使用递归查询，用户只需要发出一次查询请求。
- 迭代查询指的是查询请求后，域名服务器返回单次查询的结果。下一级的查询由用户自己请求。使用迭代查询，用户需要发出多次的查询请求。

## 5.DNS记录和报文

DNS服务器中以资源记录的形式存储信息，每一个DNS响应报文一般包含多条资源记录。一条资源记录的具体的格式为
(Name，Value，Type，TTL)
其中TTL是资源记录的生存时间，它定义了资源记录能够被其他的 DNS服务器缓存多长时间。
常用的一共有四种Type 的值，分别是A、NS、CNAME和MX，不同Type的值，对应资源记录代表的意义不同。

1. 如果Type = A，则Name是主机名，Value是主机名对应的IP地址。因此，一条记录为A的资源记录，提供了标准的主机名到IP地址的映射。
2.  如果Type = NS，则Name是个域名，Value是负责该域名的DNS服务器的主机名。这个记录主要用于DNS链式查询时，返回下一级需要查询的 DNS服务器的信息。
3. 如果 Type = CNAME，则Name为别名，Value为该主机的规范主机名。该条记录用于向查询的主机返回一个主机名对应的规范主机名，从而告诉查询主机去查询这个主机名的IP地址。主机别名主要是为了通过给一些复杂的主机名提供一个便于记忆的简单的别名。
   4.如果Type = MX，则Name为一个邮件服务器的别名，Value为邮件服务器的规范。

# 二、网络模型

## 1.OSI七层模型

![img](计算机网络.assets/1604024701811-7ac177bc-d649-45b8-8646-53af8f18a0de.webp)

1. 应用层

   0SI参考模型中最靠近用户的一层，是为计算机用户提供应用接口，也为用户直接提供各种网络服务。我们常见应用层的网络服务协议有:**HTTP ,HTTPS,FTP，POP3、SMTP**等。

   - 在客户端与服务器中经常会有数据的请求，这个时候就是会用到 **http(hyper text transfer protocol)(超文本传输协议)**或者**https** ,在后端设计数据接口时，我们常常使用到这个协议。
   - **FTP**是文件传输协议，在开发过程中，个人并没有涉及到，但是我想，在一些资源网站，比如百度网盘`迅雷应该是基于此协议的。
   - **SMTP**是simple mail transfer protocol(简单邮件传输协议)。在一个项目中，在用户邮箱验证码登录的功能时，使用到了这个协议。

2. 表示层

   表示层提供各种用于应用层数据的编码和转换功能,确保一个系统的应用层发送的数据能被另一个系统的应用层识别。如果必要，该层可提供一种标准表示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。
   例如，**IBM**主机使用**EBCDIC**编码，而大部分**PC**机使用的是**ASCII** 码。在这种情况下，便需要表示层来完成这种转换。如果您想要用尽量少的词语来记住这第6层，那就是“一种通用的数据格式”。
   在项目开发中，为了方便数据传输，可以使用base64对数据进行编解码。如果按功能来划分，base64应该是工作在表示层。

3. 会话层

   会话层就是负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。

4. 传输层

   传输层建立了主机端到端的链接，传输层的作用是**为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题**。该层向高层屏蔽了下层数据通信的细节，使高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠的数据通路。我们通常说的，**TCP、UDP**就是在这一层。端口号既是这里的“端”。

5. 网络层

   本层通过**IP寻址**来建立两个节点之间的连接，为源端的运输层送来的分组，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的运输层。就是通常说的工P层。这一层就是我们经常说的IP协议层。IP协议是Internet 的基础。我们可以这样理解，**网络层规定了数据包的传输路线，而传输层则规定了数据包的传输方式**。

6. 数据链路层

   将比特组合成字节,再将字节组合成帧,使用链路层地址(以太网使用MAC地址)来访问介质,并进行差错检测。
   网络层与数据链路层的对比，通过上面的描述，我们或许可以这样理解，网络层是规划了数据包的传输路线，而数据链路层就是传输路线。不过，**在数据链路层上还增加了差错控制的功能**。

7. 物理层

   实际最终信号的传输是通过物理层实现的。通过物理介质传输比特流。规定了电平、速度和电缆针脚。常用设备有(各种物理设备）集线器、中继器、调制解调器、网线、双绞线、同轴电缆。这些都是物理层的传输介质。

**OSI七层模型通信特点:对等通信**

对等通信，为了使数据分组从源传送到目的地，源端OSI模型的每一层都必须与目的端的对等层进行通信，这种通信方式称为对等层通信。在每一层通信过程中，使用本层自己协议进行通信。

## 2.TCP/IP五层协议

TCP/IP五层协议和OSI七层协议对应的关系如下

![img](计算机网络.assets/1604025489154-966a96f5-1c8e-4d03-b9f9-f51250f63a22.png)

- **应用层(application layer)**:直接为应用进程提供服务。应用层协议定义的是应用进程间通讯和交互的规则，不同的应用有着不同的应用层协议，如HTTP协议(万维网服务)、FTP协议(文件传输)、SMTP协议(电子邮件)、DNS(域名查询)等。
- **传输层(transport layer)**:有时也译为运输层，它负责为两台主机中的进程提供通信服务。该层主要有以下两种协议:
  - 传输控制协议(Transmission Control Protocol，TCP):提供面向连接的、可靠的数据传输服务，数据传输的基本单位是报文段(segment) ;
  - 用户数据报协议(User Datagram Protocol，UDP):提供无连接的、尽最大努力的数据传输服务，但不保证数据传输的可靠性，数据传输的基本单位是用户数据报。
- **网络层(internet layer)**:有时也译为网际层，它负责为两台主机提供通信服务，并通过选择合适的路由将数据传递到目标主机。
- **数据链路层(data link layer)**:负责将网络层交下来的IP数据报封装成帧，并在链路的两个相邻节点间传送帧，每一帧都包含数据和必要的控制信息(如同步信息、地址信息、差错控制等)。
- **物理层(physical Layer)**:确保数据可以在各种物理媒介上进行传输，为数据的传输提供可靠的环境。

**每一层都对应着不同的设备**

![img](计算机网络.assets/1604025001463-47398363-0ab1-4bcf-b247-5d3d76ce117a.webp)

**每一层实现的协议各不相同**

![img](计算机网络.assets/1604025001203-7b104c36-1453-475e-a282-ff2e9cb19e2c.webp)

同样，TCP/IP五层协议的通信方式也是对等通信:

![image.png](计算机网络.assets/1604065635582-1a4e62ba-bdfa-45db-8a56-0302ff9a8020.png)

**各层传输单位**

应用层：报文

传输层：报文段

网络层：IP数据报/分组

数据链路层：帧

物理层：比特流

# 三、HTTP

## 1.HTTP概述

HTTP是超文本传输协议，它定义了客户端和服务器之间交换报文的格式和方式，默认使用80端口。它使用TCP作为传输层协议，保证了数据传输的可靠性。

1. HTTP优点
   - 支持客户端/服务器模式
   - **简单快速**:客户向服务器请求服务时，只需传送请求方法和路径。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
   - **无连接**:无连接的含义是限制每次链接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开链接，采用这种方式可以节省传输时间。
   - **无状态**: HTTP协议是无状态协议，这里的状态是指通信过程的上下文信息。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能会导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就比较快。
   - **灵活**:HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
2. HTTP缺点
   - **无状态**:HTTP是一个无状态的协议，HTTP服务器不会保存关于客户的任何信息。
   - **明文传输**:协议中的报文使用的是文本形式，这就直接暴露给外界，不安全。
   - **不安全**
     - 通信使用明文(不加密)，内容可能会被窃听
     - 不验证通信方的身份，因此有可能遭遇伪装无法证明
     - 报文的完整性，所以有可能已遭篡改

## 2.HTTP性能

HTTP协议是基于**TCP/IP**，并且使用了**请求-应答的通信模式**，所以性能的关键就在这两点里。

### 1.长连接

HTTP协议有两种连接模式，一种是持续连接，一种是非连续连接。

- 非持续连接指的是服务器必须为每一个请求的对象建立和维护一个全新的连接。
- 持续连接下，TCP连接默认不关闭，可以被多个请求复用。采用持续连接的好处是可以避免每次建立TCP连接三次握手时所花费的时间。

对于不同版本的才有不同的连接方式：

- 在HTTP/1.0每发起一个请求，都要新建一次TCP连接（三次握手)，而且是**串行请求**，做了无畏的TCP连接建立和断开，**增加了通信开销**。该版本使用的非持续的连接，但是可以在请求时，加上 Connection: keep-a live来要求服务器不要关闭TCP连接。

- 在HTTP/1.1提出了**长连接**的通信方式，也叫持久连接。这种方式的好处在于减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。该版本及以后版本默认采用的是持续的连接。目前对于同一个域，大多数浏览器支持同时建立6个持久连接。

  ![img](计算机网络.assets/1604065902281-b98a486c-5442-4d0b-b58d-00aab296ce1a.png)

### 2.管道网络传输

HTTP/1.1采用了长连接的方式，这使得管道(pipeline)网络传输成为了可能。

管道(pipeline)网络传输是指:可以在同一个TCP连接里面，客户端可以发起多个请求，只要第一个请求发出去了，不必等其回来，就可以发第二个请求出去，可以减少整体的响应时间。但是服务器还是按照顺序回应请求。要是前面的回应特别慢，后面就会有许多请求排队等着。这称为**队头堵塞**。

### 3.对头堵塞

HTTP传输的报文必须是一发—收，但是，里面的任务被放在一个任务队列中串行执行，一旦队首的请求处理太慢，就会阻塞后面请求的处理。这就是HTTP队头阻塞问题。

**对头堵塞的解决方案：**

1. 并发连接:对于一个域名允许分配多个长连接，那么相当于增加了任务队列，不至于一个队伍的任务阻塞其它所有任务。
2. 域名分片:将域名分出很多二级域名，它们都指向同样的一台服务器，能够并发的长连接数变多，解决了队头阻塞的问题。

## 3.HTTP请求报文与响应报文

### 1.请求报文

请求报文由四部分组成：

- 请求⾏ 
  - 请求方法字段
  - 请求URI
  - 协议版本
- 请求头部 
  - 由关键字/值对组成，每行一对。
  - User-Agent: 产生请求的浏览器类型
  - Accept：客户端可识别的内容类型列表
  - Host: 请求的主机名，允许多个域名同处一个IP地址，即虚拟主机。
- 空⾏
- 请求体 ：post、put等携带的数据

### 2.请求方法字段

- GET: 向服务器获取数据；
- POST：将实体提交到指定的资源，通常会造成服务器资源的修改；
- PUT：上传文件，更新数据；
- DELETE：删除服务器上的对象；
- HEAD：获取报文首部，与GET相比，不返回报文主体部分；
- OPTIONS：询问支持的请求方法，用来跨域请求；
- CONNECT：要求在与代理服务器通信时建立隧道，使用隧道进行TCP通信；
- TRACE: 回显服务器收到的请求，主要⽤于测试或诊断。

### 3.响应报文

- 响应行
  - 协议版本
  - 状态码
  - 状态码的原因短语
- 响应头
  - 由响应首部组成
  - Content-Type: text/html
- 空行
- 响应体:服务器的响应数据

